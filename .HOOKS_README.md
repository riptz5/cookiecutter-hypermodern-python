# Automated Validation Hooks

## ⚠️ CRITICAL: Hooks Are Active

This repository has **automated validation hooks** that will **BLOCK commits and pushes** if validation fails.

### What's Installed

| Hook | Purpose | Blocks |
|------|---------|--------|
| **pre-commit** | Validates template before commit | ❌ Commits with invalid template |
| **pre-push** | Validates workflow compliance before push | ❌ Pushes without validation checklist |

### Hook Locations

- Pre-commit: `.git/hooks/pre-commit`
- Pre-push: `.git/hooks/pre-push`

### What They Check

#### Pre-Commit Hook
✓ Template generates successfully
✓ TOML syntax is valid
✓ No unrendered Jinja artifacts remain
✓ Python syntax is valid

#### Pre-Push Hook
✓ Validation checklist completed
✓ Test coverage is 100%
✓ Workflow compliance verified

---

## For Agents: Rules You MUST Follow

**Read `.agent_reminder.json` for detailed rules**

### Three Mandatory Code Rules

```
RULE 1: Code in tools/ → Tests in tests/
RULE 2: Code in {{cookiecutter.project_name}}/src/ → Tests in {{cookiecutter.project_name}}/tests/
RULE 3: Tests MUST be written in SAME session as code
```

### Three Mandatory Test Rules

```
TEST 1: All external dependencies MUST be mocked
TEST 2: Tests MUST pass before code is complete
TEST 3: 100% code coverage for new code
```

### Seven-Step Thinking Process (MANDATORY)

1. **Understand** - Read AGENTS.md COMPLETELY
2. **Plan** - Draft change, document steps
3. **Implement + Test** - Write code AND tests TOGETHER (same session)
4. **Verify** - Execute tests, verify code works
5. **Validate** - Run validation checklist (ALL checks must pass)
6. **Refine** - If ANY check fails, fix and repeat
7. **Present** - Only after ALL steps 1-6 complete

### Prohibited Actions

```
⛔ DO NOT run release commands interactively
⛔ DO NOT modify .github/workflows without explicit approval
⛔ DO NOT simplify {{cookiecutter.*}} expressions
⛔ DO NOT present code without pre-presentation checklist
⛔ DO NOT skip validation steps
⛔ DO NOT write code without tests
⛔ DO NOT bypass git hooks with --no-verify
```

---

## If a Hook Blocks You

**This means the code/tests did not meet requirements.**

### What To Do

1. **Don't bypass the hook** (don't use `--no-verify`)
2. **Run the monitor to see what failed**:
   ```bash
   python3 tools/hook_monitor.py
   ```
3. **Check the status file**:
   ```bash
   cat .hook_status.json
   ```
4. **Fix the issues** (code, tests, or validation)
5. **Re-run validation**:
   ```bash
   python3 tools/validate_template.py
   ```
6. **Try committing/pushing again**

### Auto-Recovery

The monitor script can auto-fix common issues:
```bash
python3 tools/hook_monitor.py
```

---

## Verification Commands

Check hook status:
```bash
python3 tools/hook_monitor.py
```

Manually run pre-commit checks:
```bash
bash .git/hooks/pre-commit
```

Manually run pre-push checks:
```bash
bash .git/hooks/pre-push
```

Validate template:
```bash
python3 tools/validate_template.py
```

---

## For Users: Temporarily Disable (Not Recommended)

**Only for debugging - re-enable after:**

```bash
# Disable temporarily
chmod -x .git/hooks/pre-commit
chmod -x .git/hooks/pre-push

# Re-enable after debugging
chmod +x .git/hooks/pre-commit
chmod +x .git/hooks/pre-push
```

---

## Files Created

- `.git/hooks/pre-commit` - Pre-commit validation hook
- `.git/hooks/pre-push` - Pre-push compliance hook
- `.agent_reminder.json` - Rules for AI agents
- `.hook_status.json` - Hook status report
- `tools/hook_monitor.py` - Hook monitor & recovery script

---

## Next Steps

1. Read `.agent_reminder.json`
2. Read AGENTS.md (complete)
3. Follow the 7-step thinking process for all changes
4. Run `python3 tools/hook_monitor.py` to verify hooks are operational

✅ Hooks are currently **OPERATIONAL**.
