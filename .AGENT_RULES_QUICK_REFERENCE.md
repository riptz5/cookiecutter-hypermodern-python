# ğŸš€ Quick Reference: Agent Rules

**Print this and keep it visible while coding.**

---

## ğŸ”´ CRITICAL: Before You Write Code

- [ ] Read AGENTS.md COMPLETELY (not just skimming)
- [ ] Run `python3 tools/agent_onboarding.py`
- [ ] Run `python3 tools/hook_monitor.py` (verify hooks OK)
- [ ] Understand the 7-step process below

---

## ğŸ“ Where Code Goes

| File Type | Location | Test Location | Example |
|-----------|----------|---------------|---------|
| **Tool** | `tools/` | `tests/` | `tools/my_tool.py` â†’ `tests/test_my_tool.py` |
| **Template Code** | `{{cookiecutter.project_name}}/src/` | `{{cookiecutter.project_name}}/tests/` | `src/pkg/file.py` â†’ `tests/test_file.py` |

---

## ğŸ”„ 7-Step Process (MANDATORY)

```
1ï¸âƒ£  UNDERSTAND
    â””â”€ Read AGENTS.md COMPLETELY
    â””â”€ Read all relevant files
    â””â”€ Document scope

2ï¸âƒ£  PLAN
    â””â”€ Draft change
    â””â”€ List all steps
    â””â”€ Get user approval

3ï¸âƒ£  IMPLEMENT + TEST
    â””â”€ Write code AND tests TOGETHER
    â””â”€ SAME session, not separate
    â””â”€ Mock all external dependencies
    â””â”€ 100% coverage for new code

4ï¸âƒ£  VERIFY
    â””â”€ Run: python3 -m pytest tests/
    â””â”€ ALL tests pass
    â””â”€ Fix failures

5ï¸âƒ£  VALIDATE
    â””â”€ Run: python3 tools/validate_template.py
    â””â”€ ALL checks pass

6ï¸âƒ£  REFINE
    â””â”€ Any failures? Fix and repeat
    â””â”€ All checks pass? Continue
    â””â”€ Don't skip!

7ï¸âƒ£  PRESENT
    â””â”€ ONLY after steps 1-6 done
    â””â”€ All checks passing
    â””â”€ Pre-presentation checklist done
```

---

## âœ… Pre-Presentation Checklist

**ALL boxes must be checked before presenting:**

```
[ ] Code implemented
[ ] Tests written (100% coverage)
[ ] Tests pass: python3 -m pytest tests/
[ ] Template generated: cookiecutter . --no-input --overwrite-if-exists
[ ] TOML valid: No parse errors
[ ] Python valid: No syntax errors
[ ] No Jinja artifacts in generated project
[ ] Code actually works (manual test)
[ ] Linter checks pass
[ ] Docs updated (if needed)
[ ] Validation passed: python3 tools/validate_template.py
```

**If ANY unchecked: Fix it, re-validate, then present.**

---

## ğŸ§ª Test Rules

**MANDATORY:**

1. **Mock everything external**
   - GitHub API â†’ Mock `github3` or `requests`
   - Git commands â†’ Mock `subprocess`
   - File system â†’ Mock `Path`
   - Environment variables â†’ Mock `os.getenv`

2. **Tests MUST pass**
   ```bash
   python3 -m pytest tests/
   # ALL tests must pass, NO failures
   ```

3. **100% coverage for new code**
   ```bash
   # No uncovered lines allowed in new code
   ```

4. **Write tests in SAME session as code**
   - Same conversation thread
   - No "testing" comes later

---

## â›” Prohibited Actions

```
âŒ DO NOT run release commands interactively
âŒ DO NOT modify .github/workflows without approval
âŒ DO NOT simplify {{cookiecutter.*}} (template variables!)
âŒ DO NOT present without pre-presentation checklist
âŒ DO NOT skip validation steps
âŒ DO NOT write code without tests (same session)
âŒ DO NOT bypass hooks with --no-verify
âŒ DO NOT create unnecessary documents
```

---

## ğŸ”’ Hook System (Auto-Enforcement)

**Hooks WILL BLOCK you if you violate rules:**

| Hook | Triggers | Blocks If | Fix |
|------|----------|-----------|-----|
| **pre-commit** | `git commit` | Template invalid, bad syntax, Jinja artifacts | `python3 tools/validate_template.py` |
| **pre-push** | `git push` | Validation incomplete, coverage <100% | `python3 tools/hook_monitor.py` |

**If blocked:**
1. `python3 tools/hook_monitor.py`
2. Read `.hook_status.json`
3. Fix issues
4. `python3 tools/validate_template.py`
5. Try again

---

## ğŸ” Quick Commands

```bash
# Learn the rules
python3 tools/agent_onboarding.py

# Check hooks
python3 tools/hook_monitor.py

# Validate everything
python3 tools/validate_template.py

# Run tests
python3 -m pytest tests/

# Generate template
cookiecutter . --no-input --overwrite-if-exists

# All at once
python3 tools/validate_template.py && python3 -m pytest tests/ && python3 tools/hook_monitor.py
```

---

## ğŸ“‹ Check Your Work

**Before committing:**
```bash
# 1. Tests pass
python3 -m pytest tests/

# 2. Template valid
python3 tools/validate_template.py

# 3. Hooks operational
python3 tools/hook_monitor.py
```

**If ALL pass: Ready to commit**
**If ANY fail: Fix it first**

---

## ğŸ¯ Summary

| Do This | Don't Do This |
|---------|---------------|
| âœ… Write code + tests together | âŒ Write code then tests later |
| âœ… Mock external dependencies | âŒ Use real API calls in tests |
| âœ… Follow 7-step process | âŒ Skip validation steps |
| âœ… Verify all tests pass | âŒ Present with failing tests |
| âœ… Use {{cookiecutter.*}} in templates | âŒ Simplify template variables |
| âœ… Run pre-presentation checklist | âŒ Present without checking |
| âœ… Let hooks block bad code | âŒ Bypass hooks with --no-verify |

---

## ğŸ“š Reference Files

- **AGENTS.md** - Source of truth (read completely)
- **.agent_reminder.json** - Rule summary
- **.HOOKS_README.md** - How hooks work
- **.AGENT_RULES_QUICK_REFERENCE.md** - This file
- **tools/agent_onboarding.py** - Full training script
- **tools/hook_monitor.py** - Hook checker & recovery

---

**Questions?** Read AGENTS.md first. It's the ground truth.
